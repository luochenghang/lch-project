<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lch.repo.common.ResourceRepo">

	<insert id="addFileResource" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO t_file_resource(
			obj_id,
			type,
			url,
			create_date
		)
		SELECT
			#{objId},
			#{type},
			#{url},
			NOW()
		FROM dual
		WHERE NOT EXISTS(SELECT id FROM t_file_resource WHERE obj_id = #{objId} AND `type` != #{type} and url = #{url})
	</insert>


</mapper>