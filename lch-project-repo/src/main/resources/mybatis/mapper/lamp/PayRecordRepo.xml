<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lch.repo.lamp.PayRecordRepo">

	<select id="getAllPayRecord" resultType="com.lch.entity.lamp.vo.PayRecordVo">
		SELECT
			t.id,
			t.name,
			t.address,
			t.goodsId,
			t.phone,
			t.num,
			t.realPrice,
			t.earnPrice,
			t.createDate,
			t.payDate,
			
			g.title as 'goodsName',
			d.value as 'goodsType'
			
		FROM
		t_pay_record t
		JOIN t_goods g on t.goodsId = g.id
		JOIN t_sys_dict d ON g.goodsType = d.`key` and
		d.`type` ='goodsType'
		WHERE 1=1
		
		ORDER BY t.createDate desc
	</select>

	<insert id="insert">
		insert into t_pay_record(
			name,
			goodsId,
			address,
			phone,
			num,
			realPrice,
			earnPrice,
			createDate,
			payDate
		)
		SELECT
		#{name},
		#{goodsId},
		#{address},
		#{phone},
		#{num},
		#{realPrice},
		#{earnPrice},
		NOW(),
		#{payDate}
		FROM
		dual
		WHERE NOT EXISTS(SELECT id FROM t_pay_record WHERE name = #{name} and goodsId=#{goodsId} and address=#{address}
		and realPrice=#{realPrice} and num=#{num} and payDate = #{payDate})
	</insert>


	<update id="update">
		update t_pay_record set
		<if test="name != null and name != ''">name=#{name},</if>
		<if test="goodsId != null">goodsId=#{goodsId},</if>
		<if test="phone != null">phone=#{phone},</if>
		<if test="address != null">address=#{address},</if>
		<if test="realPrice != null">`realPrice`=#{realPrice},</if>
		<if test="num != null">`num`=#{num},</if>
		<if test="payDate != null">`payDate`=#{payDate},</if>
		updateDate = NOW()
		WHERE id = #{id}
	</update>
	
	<delete id="delete">
		delete from t_pay_record where id = #{id}
	</delete>
	
	<select id="get" resultType="com.lch.entity.lamp.vo.PayRecordVo">
	SELECT
			t.id,
			t.name,
			t.address,
			t.goodsId,
			t.phone,
			t.num,
			t.realPrice,
			t.earnPrice,
			t.createDate,
			t.payDate,
			
			g.title as 'goodsName',
			d.value as 'goodsType'
			
		FROM
		t_pay_record t
		JOIN t_goods g on t.goodsId = g.id
		JOIN t_sys_dict d ON g.goodsType = d.`key` and
		d.`type` ='goodsType'
		WHERE t.id=#{id}
	</select>

</mapper>